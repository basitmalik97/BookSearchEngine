(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{102:function(e,a,t){},110:function(e,a,t){"use strict";t.r(a);var n=t(0),o=t.n(n),l=t(35),r=t.n(l),s=(t(101),t(102),t(93)),c=t(132),i=t(135),m=t(129),d=t(92),u=t(55),g=t(14),b=t(120),E=t(121),p=t(131),k=t(89),v=t(122),h=t(123),w=t(139),S=t(119),I=t(77),y=t.n(I);var f=new class{getProfile(){return y()(this.getToken())}loggedIn(){const e=this.getToken();return!!e&&!this.isTokenExpired(e)}isTokenExpired(e){try{return y()(e).exp<Date.now()/1e3}catch(a){return!1}}getToken(){return localStorage.getItem("id_token")}login(e){localStorage.setItem("id_token",e),window.location.assign("/")}logout(){localStorage.removeItem("id_token"),window.location.assign("/")}};var O,C,j,B,$=t(46),F=t(133);const T=Object(F.a)(O||(O=Object($.a)(["\n  mutation login($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n      user {\n        _id\n        username\n      }\n    }\n  }\n"]))),x=Object(F.a)(C||(C=Object($.a)(["\n  mutation addUser($username: String!, $email: String!, $password: String!) {\n    addUser(username: $username, email: $email, password: $password) {\n      token\n      user {\n        _id\n        username\n      }\n    }\n  }\n"]))),L=Object(F.a)(j||(j=Object($.a)(["\n  mutation saveBook(\n    $authors: [String]!\n    $description: String!\n    $title: String!\n    $bookId: ID!\n    $image: String!\n  ) {\n    saveBook(\n      authors: $authors\n      description: $description\n      title: $title\n      bookId: $bookId\n      image: $image\n    ) {\n      _id\n      username\n      bookCount\n      savedBooks {\n        bookId\n        title\n      }\n    }\n  }\n"]))),_=Object(F.a)(B||(B=Object($.a)(["\n  mutation removeBook($bookId: ID!) {\n    removeBook(bookId: $bookId) {\n      _id\n      username\n      bookCount\n      savedBooks {\n        bookId\n        title\n      }\n    }\n  }\n"])));var N,q=()=>{const[e,a]=Object(n.useState)([]),[t,l]=Object(n.useState)(""),[r,s]=Object(n.useState)(localStorage.getItem("saved_books")?JSON.parse(localStorage.getItem("saved_books")):[]),[c]=Object(S.a)(L);Object(n.useEffect)(()=>()=>{var e;(e=r).length?localStorage.setItem("saved_books",JSON.stringify(e)):localStorage.removeItem("saved_books")});return o.a.createElement(o.a.Fragment,null,o.a.createElement(b.a,{fluid:!0,className:"text-light bg-dark"},o.a.createElement(E.a,null,o.a.createElement("h1",null,"Search for Books!"),o.a.createElement(p.a,{onSubmit:async e=>{if(e.preventDefault(),!t)return!1;try{const e=await(n=t,fetch("https://www.googleapis.com/books/v1/volumes?q=".concat(n)));if(!e.ok)throw new Error("something went wrong!");const{items:o}=await e.json(),r=o.map(e=>{var a;return{bookId:e.id,authors:e.volumeInfo.authors||["No author to display"],title:e.volumeInfo.title,description:e.volumeInfo.description,image:(null===(a=e.volumeInfo.imageLinks)||void 0===a?void 0:a.thumbnail)||""}});a(r),l("")}catch(o){console.error(o)}var n}},o.a.createElement(p.a.Row,null,o.a.createElement(k.a,{xs:12,md:8},o.a.createElement(p.a.Control,{name:"searchInput",value:t,onChange:e=>l(e.target.value),type:"text",size:"lg",placeholder:"Search for a book"})),o.a.createElement(k.a,{xs:12,md:4},o.a.createElement(v.a,{type:"submit",variant:"success",size:"lg"},"Submit Search")))))),o.a.createElement(E.a,null,o.a.createElement("h2",null,e.length?"Viewing ".concat(e.length," results:"):"Search for a book to begin"),o.a.createElement(h.a,null,e.map(a=>o.a.createElement(w.a,{key:a.bookId,border:"dark"},a.image?o.a.createElement(w.a.Img,{src:a.image,alt:"The cover for ".concat(a.title),variant:"top"}):null,o.a.createElement(w.a.Body,null,o.a.createElement(w.a.Title,null,a.title),o.a.createElement("p",{className:"small"},"Authors: ",a.authors),o.a.createElement(w.a.Text,null,a.description),f.loggedIn()&&o.a.createElement(v.a,{disabled:null===r||void 0===r?void 0:r.some(e=>e===a.bookId),className:"btn-block btn-info",onClick:()=>(async a=>{const t=e.find(e=>e.bookId===a);if(!(f.loggedIn()?f.getToken():null))return!1;console.log(t);try{await c({variables:{...t}}),s([...r,t.bookId])}catch(n){console.error(n)}})(a.bookId)},(null===r||void 0===r?void 0:r.some(e=>e===a.bookId))?"This book has already been saved!":"Save this Book!")))))))},D=t(140);const P=Object(F.a)(N||(N=Object($.a)(["\n  query me {\n    me {\n      _id\n      username\n      email\n      bookCount\n      savedBooks {\n        bookId\n        authors\n        description\n        title\n        image\n      }\n    }\n  }\n"])));var G=()=>{const{loading:e,data:a}=Object(D.a)(P),t=null===a||void 0===a?void 0:a.me,[n]=Object(S.a)(_),l=async e=>{if(!(f.loggedIn()?f.getToken():null))return!1;try{await n({variables:{bookId:e}}),(e=>{const a=localStorage.getItem("saved_books")?JSON.parse(localStorage.getItem("saved_books")):null;if(!a)return!1;const t=null===a||void 0===a?void 0:a.filter(a=>a!==e);localStorage.setItem("saved_books",JSON.stringify(t))})(e)}catch(a){console.error(a)}};return e?o.a.createElement("h2",null,"LOADING..."):o.a.createElement(o.a.Fragment,null,o.a.createElement(b.a,{fluid:!0,className:"text-light bg-dark"},o.a.createElement(E.a,null,o.a.createElement("h1",null,"Viewing saved books!"))),o.a.createElement(E.a,null,o.a.createElement("h2",null,t.savedBooks.length?"Viewing ".concat(t.savedBooks.length," saved ").concat(1===t.savedBooks.length?"book":"books",":"):"You have no saved books!"),o.a.createElement(h.a,null,t.savedBooks.map(e=>o.a.createElement(w.a,{key:e.bookId,border:"dark"},e.image?o.a.createElement(w.a.Img,{src:e.image,alt:"The cover for ".concat(e.title),variant:"top"}):null,o.a.createElement(w.a.Body,null,o.a.createElement(w.a.Title,null,e.title),o.a.createElement("p",{className:"small"},"Authors: ",e.authors),o.a.createElement(w.a.Text,null,e.description),o.a.createElement(v.a,{className:"btn-block btn-danger",onClick:()=>l(e.bookId)},"Delete this Book!")))))))},U=t(136),V=t(134),Y=t(130),J=t(137),K=t(125);var z=()=>{const[e,a]=Object(n.useState)({username:"",email:"",password:""}),[t]=Object(n.useState)(!1),[l,r]=Object(n.useState)(!1),[s]=Object(S.a)(x),c=t=>{const{name:n,value:o}=t.target;a({...e,[n]:o})};return o.a.createElement(o.a.Fragment,null,o.a.createElement(p.a,{noValidate:!0,validated:t,onSubmit:async t=>{t.preventDefault();!1===t.currentTarget.checkValidity()&&(t.preventDefault(),t.stopPropagation());try{const{data:a}=await s({variables:{...e}});f.login(a.addUser.token)}catch(n){console.error(n),r(!0)}a({username:"",email:"",password:""})}},o.a.createElement(K.a,{dismissible:!0,onClose:()=>r(!1),show:l,variant:"danger"},"Something went wrong with your signup!"),o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,{htmlFor:"username"},"Username"),o.a.createElement(p.a.Control,{type:"text",placeholder:"Your username",name:"username",onChange:c,value:e.username,required:!0}),o.a.createElement(p.a.Control.Feedback,{type:"invalid"},"Username is required!")),o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,{htmlFor:"email"},"Email"),o.a.createElement(p.a.Control,{type:"email",placeholder:"Your email address",name:"email",onChange:c,value:e.email,required:!0}),o.a.createElement(p.a.Control.Feedback,{type:"invalid"},"Email is required!")),o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,{htmlFor:"password"},"Password"),o.a.createElement(p.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:c,value:e.password,required:!0}),o.a.createElement(p.a.Control.Feedback,{type:"invalid"},"Password is required!")),o.a.createElement(v.a,{disabled:!(e.username&&e.email&&e.password),type:"submit",variant:"success"},"Submit")))};var A=()=>{const[e,a]=Object(n.useState)({email:"",password:""}),[t]=Object(n.useState)(!1),[l,r]=Object(n.useState)(!1),[s]=Object(S.a)(T),c=t=>{const{name:n,value:o}=t.target;a({...e,[n]:o})};return o.a.createElement(o.a.Fragment,null,o.a.createElement(p.a,{noValidate:!0,validated:t,onSubmit:async t=>{t.preventDefault();!1===t.currentTarget.checkValidity()&&(t.preventDefault(),t.stopPropagation());try{const{data:a}=await s({variables:{...e}});f.login(a.login.token)}catch(n){console.error(n),r(!0)}a({username:"",email:"",password:""})}},o.a.createElement(K.a,{dismissible:!0,onClose:()=>r(!1),show:l,variant:"danger"},"Something went wrong with your login credentials!"),o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,{htmlFor:"email"},"Email"),o.a.createElement(p.a.Control,{type:"text",placeholder:"Your email",name:"email",onChange:c,value:e.email,required:!0}),o.a.createElement(p.a.Control.Feedback,{type:"invalid"},"Email is required!")),o.a.createElement(p.a.Group,null,o.a.createElement(p.a.Label,{htmlFor:"password"},"Password"),o.a.createElement(p.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:c,value:e.password,required:!0}),o.a.createElement(p.a.Control.Feedback,{type:"invalid"},"Password is required!")),o.a.createElement(v.a,{disabled:!(e.email&&e.password),type:"submit",variant:"success"},"Submit")))};var M=()=>{const[e,a]=Object(n.useState)(!1);return o.a.createElement(o.a.Fragment,null,o.a.createElement(U.a,{bg:"dark",variant:"dark",expand:"lg"},o.a.createElement(E.a,{fluid:!0},o.a.createElement(U.a.Brand,{as:u.b,to:"/"},"Google Books Search"),o.a.createElement(U.a.Toggle,{"aria-controls":"navbar"}),o.a.createElement(U.a.Collapse,{id:"navbar"},o.a.createElement(V.a,{className:"ml-auto"},o.a.createElement(V.a.Link,{as:u.b,to:"/"},"Search For Books"),f.loggedIn()?o.a.createElement(o.a.Fragment,null,o.a.createElement(V.a.Link,{as:u.b,to:"/saved"},"See Your Books"),o.a.createElement(V.a.Link,{onClick:f.logout},"Logout")):o.a.createElement(V.a.Link,{onClick:()=>a(!0)},"Login/Sign Up"))))),o.a.createElement(Y.a,{size:"lg",show:e,onHide:()=>a(!1),"aria-labelledby":"signup-modal"},o.a.createElement(J.a.Container,{defaultActiveKey:"login"},o.a.createElement(Y.a.Header,{closeButton:!0},o.a.createElement(Y.a.Title,{id:"signup-modal"},o.a.createElement(V.a,{variant:"pills"},o.a.createElement(V.a.Item,null,o.a.createElement(V.a.Link,{eventKey:"login"},"Login")),o.a.createElement(V.a.Item,null,o.a.createElement(V.a.Link,{eventKey:"signup"},"Sign Up"))))),o.a.createElement(Y.a.Body,null,o.a.createElement(J.a.Content,null,o.a.createElement(J.a.Pane,{eventKey:"login"},o.a.createElement(A,{handleModalClose:()=>a(!1)})),o.a.createElement(J.a.Pane,{eventKey:"signup"},o.a.createElement(z,{handleModalClose:()=>a(!1)})))))))};const H=Object(s.a)({uri:"/graphql"}),R=Object(d.a)((e,a)=>{let{headers:t}=a;const n=localStorage.getItem("id_token");return{headers:{...t,authorization:n?"Bearer ".concat(n):""}}}),W=new c.a({link:R.concat(H),cache:new i.a});var Q=function(){return o.a.createElement(m.a,{client:W},o.a.createElement(u.a,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(M,null),o.a.createElement(g.c,null,o.a.createElement(g.a,{exact:!0,path:"/",component:q}),o.a.createElement(g.a,{exact:!0,path:"/saved",component:G}),o.a.createElement(g.a,{render:()=>o.a.createElement("h1",{className:"display-2"},"Wrong page!")})))))};r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Q,null)),document.getElementById("root"))},96:function(e,a,t){e.exports=t(110)}},[[96,1,2]]]);
//# sourceMappingURL=main.c69e3c1d.chunk.js.map